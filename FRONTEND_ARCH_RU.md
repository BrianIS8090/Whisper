# Архитектура Графической Оболочки (Frontend) Wisper

В этом документе описано техническое устройство графического интерфейса пользователя (GUI) приложения Wisper. 

Приложение построено на базе **Python** с использованием биндингов **Qt** и современной библиотеки компонентов, имитирующей нативный дизайн Windows 11.

---

## 1. Стек Технологий

*   **Язык**: Python 3.10+
*   **Фреймворк UI**: [PyQt6](https://pypi.org/project/PyQt6/) — профессиональный набор инструментов для создания GUI.
*   **Дизайн-система**: [PyQt-Fluent-Widgets](https://github.com/zhiyiYo/PyQt-Fluent-Widgets) — библиотека, предоставляющая компоненты в стиле Fluent Design (Windows 11), включая навигацию, карточки, слайдеры и поддержку Mica-эффекта (полупрозрачность).

---

## 2. Структура Файлов

Весь код интерфейса находится в папке `Frontend/`.

### `main.py` — Точка входа
Главный файл, который запускает `QApplication`.
*   Создает основное окно класса `MainWindow`, наследуемое от `FluentWindow`.
*   Инициализирует навигационную панель (Side Bar).
*   Загружает и регистрирует субинтерфейсы (вкладки).
*   Применяет позиционирование окна по центру экрана.

### `home_interface.py` — Вкладка "Диктовка" (Dictation)
Основной рабочий экран.
*   **Компоненты**:
    *   `Pivot` (Верхняя панель) для переключения режимов (Локальный/Groq/Yandex).
    *   `CardWidget` для отображения статуса (Idle/Recording/Transcribing).
    *   `TextEdit` (Консоль) для вывода логов в реальном времени.
*   **Логика**:
    *   При запуске создает экземпляр `GlobalSpeechWorker` (из `workers.py`).
    *   Подписывается на сигналы воркера (`text_ready`, `status_changed`), чтобы обновлять UI без блокировки основного потока.

### `transcribe_interface.py` — Вкладка "Файлы"
Экран для пакетной обработки аудиофайлов.
*   **Реализация**: Использует механизм Drag & Drop.
*   **Класс `FileDropWidget`**: Кастомный виджет, переопределяющий события `dragEnterEvent` и `dropEvent`.
*   При сбросе файла запускает отдельный поток `TranscribeWorker`.

### `settings_interface.py` — Вкладка "Настройки"
Экран управления конфигурацией.
*   Содержит поля ввода (`LineEdit`) для API ключей и выпадающие списки (`ComboBox`) для выбора модели.
*   Использует `ScrollArea` для удобной прокрутки опций.
*   **Сохранение**: При изменении значений перезаписывает файл `.env` в корне проекта, обеспечивая персистентность настроек.

---

## 3. Взаимодействие Логики и Интерфейса (Multithreading)

Одной из главных проблем GUI приложений является "замораживание" окна при выполнении тяжелых задач (запись звука, отправка сетевых запросов). Мы решили это с помощью `QThread`.

**Схема работы:**
1.  **GUI Thread (Основной поток)**: Отвечает *только* за отрисовку кнопок и анимаций. Никогда не выполняет долгих вычислений.
2.  **Worker Thread (Фоновый поток)**:
    *   В файле `workers.py` классы наследуются от `QObject`.
    *   Метод `run()` выполняет бесконечный цикл прослушивания клавиатуры или отправку запроса в API.
3.  **Signals & Slots (Сигналы и Слоты)**:
    *   Воркер не меняет текст на экране напрямую (это вызвало бы краш).
    *   Вместо этого он отправляет **Сигнал** (например, `text_ready("Привет")`).
    *   Интерфейс "ловит" этот сигнал в **Слоте** и безопасно обновляет виджет.

```python
# Пример из home_interface.py
self.worker.text_ready.connect(self.on_text_ready) # Связь сигнала со слотом

def on_text_ready(self, text):
    self.log_console.append(f"Распознано: {text}") # Обновление UI
```

---

## 4. Сборка (Build)

Для превращения Python-скриптов в `.exe` используется **PyInstaller**.
Конфигурация сборки находится в `Frontend/WisperAI.spec`.

Особенности сборки:
*   `noconsole=True`: Скрывает черное окно консоли.
*   `icon='assets/asteroid.ico'`: Устанавливает иконку приложения.
*   `add_data`: Включает необходимые ресурсы библиотеки Fluent Widgets внутрь EXE файла.

Запуск сборки осуществляется через батник `Frontend/build.bat`.
